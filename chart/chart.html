<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://code.highcharts.com/highcharts.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    
    <div class="container my-5">
        <h1 class="text-center mb-4">ğŸš— ì‹¤ì‹œê°„ êµí†µëŸ‰ & ì†Œìš”ì‹œê°„ ì°¨íŠ¸</h1>
    
        <div class="row g-4">
          <!-- êµí†µëŸ‰ ì¹´ë“œ -->
          <div class="col-md-6">
            <div class="card shadow-sm">
              <div class="card-header bg-primary text-white">
                êµí†µëŸ‰ ë¹„êµ ì°¨íŠ¸
              </div>
              <div class="card-body">
                <div id="traffic-chart"></div>
              </div>
            </div>
          </div>
    
          <!-- ì†Œìš”ì‹œê°„ ì¹´ë“œ -->
          <div class="col-md-6">
            <div class="card shadow-sm">
              <div class="card-header bg-success text-white">
                ì„œìš¸ ì¶œë°œ ì£¼ìš” ë„ì‹œ ì†Œìš”ì‹œê°„
              </div>
              <div class="card-body">
                <div id="time-chart"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="my-4 text-end">
          <a href="../index.html" class="btn btn-danger">ë©”ì¸í˜ì´ì§€ë¡œ ì´ë™</a>
        </div>
    </div>
    <script>

        /*
        cjunkook	string	ì „êµ­êµí†µëŸ‰
        cjibangDir	string	ì§€ë°©ë°©í–¥ êµí†µëŸ‰
        cseoulDir	string	ì„œìš¸ë°©í–¥ êµí†µëŸ‰
        csudj	string	ì„œìš¸->ëŒ€ì „ ì†Œìš”ì‹œê°„
        csudg	string	ì„œìš¸->ëŒ€êµ¬ ì†Œìš”ì‹œê°„
        csuus	string	ì„œìš¸->ìš¸ì‚° ì†Œìš”ì‹œê°„
        csubs	string	ì„œìš¸->ë¶€ì‚° ì†Œìš”ì‹œê°„
        csugj	string	ì„œìš¸->ê´‘ì£¼ ì†Œìš”ì‹œê°„
        csump	string	ì„œìš¸->ëª©í¬ ì†Œìš”ì‹œê°„
        csukr	string	ì„œìš¸->ê°•ë¦‰ ì†Œìš”ì‹œê°„

        csudj_bus	string	ì„œìš¸->ëŒ€ì „ ë²„ìŠ¤ ì†Œìš”ì‹œê°„
        csudg_bus	string	ì„œìš¸->ëŒ€êµ¬ ë²„ìŠ¤ ì†Œìš”ì‹œê°„
        csuus_bus	string	ì„œìš¸->ìš¸ì‚° ë²„ìŠ¤ ì†Œìš”ì‹œê°„
        csubs_bus	string	ì„œìš¸->ë¶€ì‚° ë²„ìŠ¤ ì†Œìš”ì‹œê°„
        csugj_bus	string	ì„œìš¸->ê´‘ì£¼ ë²„ìŠ¤ ì†Œìš”ì‹œê°„
        csump_bus	string	ì„œìš¸->ëª©í¬ ë²„ìŠ¤ ì†Œìš”ì‹œê°„
        csukr_bus	string	ì„œìš¸->ê°•ë¦‰ ë²„ìŠ¤ ì†Œìš”ì‹œê°„


        */
        // const url = "https://api.odcloud.kr/api/15068863/v1/uddi:2682c872-adbe-4623-9e29-a53467734a88?page=1&perPage=10&returnType=json&serviceKey=jv%2FOTDmJrPn66VLP9pC%2FrMASmEwWItpKnJ62rdUOu5i1j%2Fab%2BC5h9Eu%2BDW6B7S4qLx1TgQcseEigAeem0S5tcQ%3D%3D"
        const url1 = "https://data.ex.co.kr/openapi/safeDriving/forecast?key=8740149779&type=json"
        async function getData() {
            try {
                const res = await axios.get(url1);
                const items = res.data.list[0];
                console.log("ë°ì´í„° ë¡œë“œ ì„±ê³µ~");
                
                console.log(items);
                
                // xì¶• ì •ì˜
                const trafficX = ['ì „êµ­ êµí†µëŸ‰', 'ì§€ë°©ë°©í–¥ êµí†µëŸ‰', 'ì„œìš¸ë°©í–¥ êµí†µëŸ‰'];
                // yì¶•
                const trafficY = [Number(items.cjunkook), Number(items.cjibangDir), Number(items.cseoulDir)];

                 // Highcharts ì°¨íŠ¸ ê·¸ë¦¬ê¸°
                Highcharts.chart('traffic-chart', {
                chart: {
                    type: 'column'
                },
                title: {
                    text: 'êµí†µëŸ‰ ë¹„êµ ì°¨íŠ¸'
                },
                xAxis: {
                    categories: trafficX,
                    title: {
                    text: 'êµ¬ë¶„'
                    }
                },
                yAxis: {
                    min: 0,
                    title: {
                    text: 'êµí†µëŸ‰ (ë‹¨ìœ„: ëŒ€)'
                    }
                },
                series: [{
                    name: 'êµí†µëŸ‰',
                    data: trafficY
                }],
                tooltip: {
                    valueSuffix: ' ëŒ€'
                }
                });

                const timeX = ['ëŒ€ì „', 'ëŒ€êµ¬', 'ìš¸ì‚°', 'ë¶€ì‚°', 'ê´‘ì£¼', 'ëª©í¬', 'ê°•ë¦‰'];
                const timeY = [
                timeToMinutes(items.csudj),
                timeToMinutes(items.csudg),
                timeToMinutes(items.csuus),
                timeToMinutes(items.csubs),
                timeToMinutes(items.csugj),
                timeToMinutes(items.csump),
                timeToMinutes(items.csukr)
                ];

                function timeToMinutes(str){
                    if(!str || !str.includes(':')) return 0;
                    const [h, m] = str.split(':').map(Number);
                    return h*60 + m;
                }
            
                Highcharts.chart('time-chart', {
                    chart: { type: 'line'},
                    title: { text: 'ì„œìš¸ ì¶œë°œ ì£¼ìš” ë„ì‹œ ì†Œìš”ì‹œê°„' },
                    xAxis: {
                        categories: timeX,
                        title: { text: 'ë„ì‹œ' }
                    },
                    yAxis: {
                        min: 0,
                        title: { text: 'ì†Œìš”ì‹œê°„ (ë¶„)' }
                    },
                    tooltip: { valueSuffix: ' ë¶„' },
                    series: [{
                        name: 'ì†Œìš”ì‹œê°„',
                        data: timeY,
                    }]
                });


            } catch (error) {
                console.log("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨...", error);
                alert('API í˜¸ì¶œ ì‹¤íŒ¨..ã… ã… ')
            }
        };
        
        getData();
    </script>
</body>
</html>